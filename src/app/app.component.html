<div *ngIf="theme" >
  <mat-toolbar color="primary" style="justify-content: space-between;">
    <div style="display: flex; align-items: center; gap: 12px;">
      <img alt="logo" style="height: 24px;" [src]="logoUrl">
      <span style="font-weight: bold; font-size: 22px;">{{title}}</span>
    </div>
    <div>
      <div *ngIf="currentUser && userHasLoaded" style="display: flex; align-items: center; gap: 4px;">
        <button *ngIf="!donatedLoading && !donated" (click)="openLink('https://donate.stripe.com/00gdSSaFc3Ux8Sc5kk?client_reference_id=' + currentUser.uid)" mat-button>
          Donate
        </button>
        <button mat-icon-button [matMenuTriggerFor]="userMenu">
          <mat-icon fontIcon="account_circle"></mat-icon>
        </button>
      </div>
      <mat-menu #userMenu="matMenu">
        <div mat-menu-item class="mat-typography">
          <span class="mat-caption">Logged in as: {{currentUser?.isAnonymous ? 'Anonymous User' : currentUser?.displayName}}</span>
        </div>
        <button mat-menu-item (click)="leaveFeedback()">
          <mat-icon fontIcon="chat"></mat-icon>
          <span>Leave Feedback</span>
        </button>
        <button mat-menu-item (click)="logout()">
          <mat-icon fontIcon="logout"></mat-icon>
          <span>Sign Out</span>
        </button>
      </mat-menu>
    </div>
</mat-toolbar>

<div *ngIf="userHasLoaded; else loadingUser">
  <div *ngIf="currentUser; else loginOptions" style="padding: 16px; padding-bottom: 64px; position: relative">
    <router-outlet></router-outlet>
    <button matTooltip="Levi AI" matTooltipPosition="left" [matMenuTriggerFor]="menu" mat-fab style="position: fixed; right: 32px; bottom: 32px;">
      <mat-icon>smart_toy</mat-icon>
    </button>
  </div>
</div>
</div>

<mat-menu #menu="matMenu" style="border-radius: 16px;">
  <div style="margin: 12px;" (click)="$event.stopPropagation()">
    <div style="display: flex; gap: 16px; margin-bottom: 16px;" *ngIf="thinking || response">
      <img src="assets/leviai.svg" style="height: 24px;"/>
    <div *ngIf="thinking">
      Levi AI is typing...
    </div>
    <div *ngIf="!thinking">
      {{response}}
    </div>
    </div>
    <mat-form-field color="accent">
      <mat-label>Message</mat-label>
      <input matInput placeholder="Ex. What is pointing poker?" [(ngModel)]="prompt" (keydown.enter)="submitPrompt()">
      <button mat-icon-button matSuffix (click)="submitPrompt()">
        <mat-icon>send</mat-icon>
      </button>
    </mat-form-field>
  </div>
  
</mat-menu>

<ng-template #loadingUser>
  <div style="height: calc(100vh - 64px); display: flex; align-items: center; justify-content: center;">
    Loading user...
  </div>
</ng-template>

<ng-template #loginOptions>
  <div style="display: flex; align-items: center; justify-content: center;">
    <div style="max-width: 450px; display: flex; flex-direction: column; align-items: stretch; gap: 8px;">
      <h3>Get Started with Pointing Poker</h3>
      <button mat-stroked-button (click)="loginAnonymously()">
        üôá‚Äç Continue Anonymously
      </button>
      <button mat-stroked-button (click)="loginWithGoogle()">
        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
          <img src="assets/Google__G__Logo.svg" style="height: 16px" />
          Continue with Google
        </div>
      </button>
      <small style="text-align: center; width: 100%;">
        <a style="color: #4092ed !important;" href="https://www.privacypolicies.com/live/07a131dd-48aa-40f9-9cd4-859887c8eb1d">Privacy Policy</a>
      </small>
    </div>
  </div>

</ng-template>



